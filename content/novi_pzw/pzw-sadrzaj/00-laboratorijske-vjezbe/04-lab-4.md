Odlična ideja! Korištenje template repozitorija je profesionalna praksa i izvrstan način da se studenti fokusiraju na specifične zadatke nadogradnje, umjesto da ponavljaju osnovno postavljanje projekta.

Zadatak s CRUD operacijama na temu slastičarne je odličan. Osmislio sam potpuno samostalan zadatak za Labos 4 koji se savršeno uklapa u tu ideju. Studenti će dobiti djelomično funkcionalnu slastičarnu i njihov zadatak će biti implementirati **sustav za naručivanje** – klasičan primjer CRUD-a u stvarnom svijetu.

---

### Prijedlog Zadatka za Laboratorijsku Vježbu 4

**Laboratorijska vježba 4: Implementacija Sustava za Naručivanje (CRUD)**

**Cilj:** Nadograditi postojeću aplikaciju "Slastičarna" implementacijom kompletnog sustava za naručivanje. Korisnici će moći pregledavati proizvode, dodavati ih u svoju "košaricu" (narudžbu), pregledavati sadržaj košarice, te mijenjati količine ili brisati stavke iz nje.

**Početno Stanje (Sadržaj Template Repozitorija):**
Dobili ste Django projekt koji sadrži aplikaciju `slasticarna`. Projekt već ima:
*   Definiran model `Proizvod` (`naziv`, `opis`, `cijena`).
*   Stranice za prikaz liste svih proizvoda i detalja pojedinog proizvoda (`ListView` i `DetailView`).
*   Potpuno funkcionalan sustav za registraciju i prijavu korisnika (`django.contrib.auth`).
*   Osnovni `base.html` predložak i postavljene statičke datoteke.

**Vaš zadatak je izgraditi ostatak funkcionalnosti.**

---
**Zadatak 1: Modeliranje Narudžbe**

Proširite `slasticarna/models.py` modelima koji će predstavljati sustav naručivanja.

1.  **Model `Narudzba` (Order):**
    *   `user`: `ForeignKey` veza prema `User` modelu. Svaka narudžba pripada točno jednom korisniku.
    *   `created_at`: `DateTimeField` koji automatski bilježi vrijeme kreiranja.
    *   `status`: `CharField` s mogućim izborima (choices), npr. 'kreirana', 'potvrđena', 'dovršena'. Zadana vrijednost neka bude 'kreirana'.

2.  **Model `StavkaNarudzbe` (OrderItem):**
    *   Ovo je **ključni model** koji povezuje narudžbu s proizvodima.
    *   `narudzba`: `ForeignKey` veza prema modelu `Narudzba`.
    *   `proizvod`: `ForeignKey` veza prema modelu `Proizvod`.
    *   `kolicina`: `PositiveIntegerField` sa zadanom vrijednošću `1`.

3.  Nakon definiranja modela, **kreirajte i primijenite migracije** i registrirajte nove modele u `admin.py`.

**Zadatak 2: Prikaz "Košarice" (Read)**

Kreirajte stranicu na kojoj prijavljeni korisnik može vidjeti sadržaj svoje trenutne, aktivne narudžbe (košarice).

1.  **View (`PrikazKosariceView`):**
    *   Kreirajte view (npr. `DetailView` za `Narudzba` model) koji je zaštićen s `LoginRequiredMixin`.
    *   View treba prikazati **samo** onu narudžbu koja pripada trenutno prijavljenom korisniku i ima status 'kreirana'. Ako takva narudžba ne postoji, template treba prikazati poruku "Vaša košarica je prazna."
2.  **Template (`kosarica.html`):**
    *   Prikažite sve `StavkaNarudzbe` povezane s trenutnom narudžbom.
    *   Za svaku stavku, ispišite naziv proizvoda, količinu, cijenu po komadu i ukupnu cijenu za tu stavku (`kolicina * cijena`).
    *   Na dnu stranice, izračunajte i prikažite **ukupnu cijenu cijele narudžbe**.
    *   Pored svake stavke dodajte linkove/gumbe "Uredi količinu" i "Ukloni iz košarice".

**Zadatak 3: Dodavanje u Košaricu (Create)**

Na stranici s detaljima proizvoda (`ProizvodDetailView`), dodajte formu koja omogućuje korisniku da doda taj proizvod u svoju košaricu.

1.  **Forma i View logika:**
    *   Na stranici `ProizvodDetailView`, dodajte jednostavnu formu s jednim poljem za `kolicinu` i gumbom "Dodaj u košaricu". Forma treba slati `POST` zahtjev.
    *   **Ključni dio:** Proširite `ProizvodDetailView` da može obrađivati i `POST` zahtjeve. Kada primi `POST` zahtjev:
        1.  Provjerite je li korisnik prijavljen.
        2.  Pronađite ili stvorite aktivnu `Narudzba` za tog korisnika.
        3.  Provjerite postoji li taj proizvod već u košarici. Ako postoji, samo povećajte `kolicinu`. Ako ne, stvorite novu `StavkaNarudzbe`.
        4.  Nakon dodavanja, preusmjerite korisnika na stranicu za prikaz košarice.

**Zadatak 4: Uređivanje i Brisanje iz Košarice (Update & Delete)**

Implementirajte funkcionalnost za uređivanje i brisanje stavki.

1.  **View za uređivanje (`StavkaUpdateView`):**
    *   Koristite `UpdateView` za model `StavkaNarudzbe`. Dozvolite uređivanje samo polja `kolicina`.
    *   **Autorizacija:** Osigurajte pomoću `UserPassesTestMixin` da korisnik može uređivati samo stavke iz **vlastite** narudžbe.
2.  **View za brisanje (`StavkaDeleteView`):**
    *   Koristite `DeleteView` za model `StavkaNarudzbe`.
    *   **Autorizacija:** Također osigurajte da korisnik može brisati samo stavke iz vlastite narudžbe.
3.  Povežite ove viewove s URL-ovima i linkovima iz `kosarica.html` templatea.

---

### Pripremni Materijali za Laboratorijsku Vježbu 4

Evo i `.md` datoteke s pripremnim materijalima za ovaj novi, samostalni zadatak.

---
---
parent: 'Laboratorijske Vježbe'
nav_order: 4
title: 'Priprema za Labos 4: Implementacija Košarice (CRUD)'
---

# Priprema za Labos 4: Implementacija Košarice (CRUD)

**Cilj vježbe:** Ova vježba je simulacija realnog zadatka nadogradnje postojeće aplikacije. Implementirat ćete kompletnu funkcionalnost "košarice za kupovinu", prolazeći kroz sve faze CRUD ciklusa (Create, Read, Update, Delete) u kontekstu vlasništva podataka i autorizacije.

Za uspješno rješavanje, ključno je razumijevanje sljedećih naprednijih koncepata.

## Ključni Koncepti za Ovu Vježbu

### 1. `ManyToManyField` s Pomoćnim Modelom (`through`)
U prošlim vježbama koristili smo jednostavni `ManyToManyField`. Međutim, kada trebamo spremiti dodatne informacije o samoj vezi (npr. **koliko** je proizvoda u narudžbi), moramo definirati **pomoćni (intermediate) model**.

**Što morate znati:**
*   Kako definirati tri modela: `Narudzba`, `Proizvod` i `StavkaNarudzbe` koja ih povezuje.
*   Kako u `Narudzba` modelu definirati `ManyToManyField` prema `Proizvod` modelu, koristeći `through='StavkaNarudzbe'` argument.

    **Preporučeni resurs:** [Službena Django dokumentacija za `ManyToManyField` s `through`](https://docs.djangoproject.com/en/stable/topics/db/models/#extra-fields-on-many-to-many-relationships)

### 2. Obrada `POST` Zahtjeva u `DetailView`
Za dodavanje proizvoda