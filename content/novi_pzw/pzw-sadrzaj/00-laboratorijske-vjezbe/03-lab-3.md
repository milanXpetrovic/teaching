U redu, analizirat ću oba zadatka, spojiti najbolje elemente i kreirati poboljšanu, koherentnu laboratorijsku vježbu. Zatim ću napisati detaljne pripremne materijale za nju.

---

### Analiza i Poboljšanje Zadatka

**Prvi zadatak (Knjižnica):**
*   **Snage:** Odličan je jer uvodi studente u kreiranje vlastitih `manage.py` naredbi i korištenje biblioteka za generiranje testnih podataka (`factory-boy`), što je vrlo korisna i realna vještina. Također, dobro pokriva osnove nasljeđivanja predložaka i korištenje filtera (`truncatewords`).
*   **Slabosti:** Malo je nejasan oko toga kako točno prikazati broj autora. Također, URL-ovi `/home/`, `/autori/` su OK, ali mogu biti bolje strukturirani unutar aplikacijskog namespacea.

**Drugi zadatak (Sladoledi - nadogradnja na Lab 2):**
*   **Snage:** Dobra nadogradnja na prethodni labos. Uvodi naprednije filtriranje (`startswith`) i koncept "početne stranice" (homepage).
*   **Slabosti:** Malo je konfuzan. Miješa koncepte (`/slovo` ispisuje napitke, a nejasno je odakle dolaze napitci ako smo radili sa sladoledima). Nasljeđivanje `base.html` (ili u ovom slučaju `home.html`) je ključan koncept i ovdje je dobro postavljen.

**Prijedlog Spojenog i Poboljšanog Zadatka (Lab 3):**

Ovaj zadatak kombinira najbolje od oba: napredne `manage.py` naredbe i generiranje podataka iz prvog, te napredno filtriranje i nasljeđivanje iz drugog, ali unutar jedne konzistentne teme (Knjižnica).

---
**Laboratorijska vježba 3: Generiranje Testnih Podataka i Napredno Filtriranje**

**Cilj:** U ovoj vježbi naučit ćete kako automatizirati popunjavanje baze podataka pomoću vlastitih `manage.py` naredbi i biblioteke `factory-boy`. Zatim ćete primijeniti znanje o nasljeđivanju predložaka i naprednim ORM upitima kako biste stvorili dinamičnu i preglednu aplikaciju za knjižnicu.

---
**Zadatak 1: Modeliranje i Generiranje Podataka**

1.  **Postavljanje:** Kreirajte novi Django projekt `knjiznica` i unutar njega aplikaciju `katalog`. Povežite aplikaciju s projektom.
2.  **Modeli:** U `katalog/models.py` definirajte modele `Author` i `Book` kako su zadani u originalnom zadatku. Napravite i primijenite migracije.
3.  **Instalacija biblioteka:** Instalirajte potrebne biblioteke za generiranje podataka:

        pip install factory-boy Faker

4.  **Tvornice (Factories):** U `katalog/` stvorite novu datoteku `factories.py` i unutar nje kreirajte `AuthorFactory` i `BookFactory` koristeći `factory-boy`. Za `BookFactory`, `author` polje treba koristiti `factory.SubFactory(AuthorFactory)`.
5.  **Kreiranje `manage.py` naredbe:**
    *   Slijedeći Djangovu dokumentaciju, kreirajte strukturu za vlastite `management/commands` unutar `katalog` aplikacije.
    *   Unutar tog direktorija, stvorite datoteku `setup_test_data.py`.
    *   U toj datoteci, napišite naredbu koja, kada se pozove s `python manage.py setup_test_data`, radi sljedeće:
        *   Prvo obriše sve postojeće knjige i autore iz baze.
        *   Zatim, koristeći vaše tvornice, stvori **20** jedinstvenih autora i **100** nasumičnih knjiga.

**Zadatak 2: Početna Stranica i Navigacija**

1.  Kreirajte **osnovni predložak** `base.html` koji će sadržavati zajedničku strukturu (zaglavlje, podnožje, navigaciju).
2.  Kreirajte **početnu stranicu** (`home.html`) koja nasljeđuje `base.html`. Ovaj view neka bude na korijenskom URL-u (`/`).
3.  Na početnoj stranici, prikažite ukupan broj autora i ukupan broj knjiga u bazi.
4.  Dodajte dva linka na početnoj stranici koji vode na:
    *   `/katalog/autori/`
    *   `/katalog/knjige/`

**Zadatak 3: Prikaz i Filtriranje Podataka**

1.  **Prikaz Autora:**
    *   Na `/katalog/autori/` prikažite listu svih autora. Za svakog autora ispišite samo njegovo ime.
    *   Iznad liste, ispišite ukupan broj autora (npr. "Pronađeno je X autora.").

2.  **Prikaz Knjiga:**
    *   Na `/katalog/knjige/` prikažite listu svih knjiga.
    *   Za svaku knjigu prikažite **naslov**, **ime i prezime autora** i **prvih 20 riječi** sažetka (`abstract`).

3.  **Napredno Filtriranje:**
    *   Kreirajte novu stranicu na URL-u `/katalog/knjige/pretraga/`.
    *   Na toj stranici prikažite listu svih knjiga čiji naslov počinje slovom "A".
    *   Iznad liste, prikažite prigodan naslov, npr. "Knjige čiji naslov počinje slovom A".

---

### Pripremni Materijali za Laboratorijsku Vježbu 3

A sada, evo `.md` datoteke s pripremnim materijalima za ovaj poboljšani zadatak.

---
---
parent: 'Laboratorijske Vježbe'
nav_order: 3
title: 'Priprema za Labos 3: Podaci i Filtriranje'
---

# Priprema za Labos 3: Generiranje Podataka i Napredno Filtriranje

**Cilj vježbe:** U ovoj vježbi prelazimo na višu razinu upravljanja projektom. Naučit ćete kako automatizirati stvaranje velikih količina testnih podataka, što je ključno za testiranje i razvoj kompleksnijih aplikacija. Također, produbit ćemo znanje o Django ORM-u, učeći kako izvoditi naprednije upite i filtriranja.

Prije početka, ključno je da se upoznate sa sljedećim konceptima.

## Ključni Koncepti za Ovu Vježbu

### 1. Kreiranje Vlastitih `manage.py` Naredbi
Ovo je moćna značajka Djanga koja vam omogućuje da automatizirate zadatke specifične za vaš projekt. Umjesto da ručno unosite podatke, napisat ćemo skriptu koju pokrećemo iz terminala.

**Što morate znati:**
*   Kako strukturirati direktorije: unutar vaše aplikacije morate kreirati `management/commands/` direktorije.
*   Svaka naredba je `.py` datoteka unutar `commands` direktorija.
*   Strukturu datoteke naredbe: ona mora sadržavati klasu `Command` koja nasljeđuje `BaseCommand` i mora imati `handle()` metodu u kojoj se nalazi vaša logika.

    **Preporučeni resurs:** [Službena Django dokumentacija o custom management naredbama](https://docs.djangoproject.com/en/stable/howto/custom-management-commands/)

### 2. `factory-boy` i `Faker`: Generiranje Lažnih Podataka
Ručno unošenje 100 knjiga bilo bi izuzetno naporno. Zato koristimo vanjske biblioteke.

*   **`factory-boy`:** Omogućuje vam da definirate "tvornice" za vaše modele. Umjesto `Book(title=...)`, pozivat ćete `BookFactory()`, koja će sama generirati objekt s nasumičnim podacima.
*   **`Faker`:** Pomoćna biblioteka koja generira realistične lažne podatke (imena, rečenice, adrese, tekstove...). `factory-boy` se odlično integrira s njom.

**Što morate znati:**
*   Kako instalirati biblioteke (`pip install factory-boy Faker`).
*   Osnovnu sintaksu za definiranje tvornice (`class BookFactory(factory.django.DjangoModelFactory)`).
*   Kako koristiti `factory.Faker('word')` ili `factory.Faker('sentence')` za generiranje podataka.
*   Kako povezati tvornice koje imaju relacije, koristeći `factory.SubFactory`.

    **Preporučeni resurs:** [`factory-boy` dokumentacija - Django](https://factoryboy.readthedocs.io/en/latest/orms/django.html)

### 3. Nasljeđivanje Predložaka (`{% extends %}`)
Ovaj koncept smo već obradili, ali je u ovoj vježbi ključan. Morate stvoriti `base.html` koji će služiti kao kostur za sve ostale stranice, osiguravajući konzistentan izgled.

**Ponavljanje gradiva:** [Poglavlje 5.2: Nasljeđivanje Predložaka](/03-mvt-moduli/03-predlosci-statika.md#52-nasljeđivanje-predložaka-template-inheritance)

### 4. Korištenje Template Filtera (`truncatewords`)
Zadatak zahtijeva da prikažete samo dio sažetka knjige. Za to ne trebate pisati Python logiku, već koristiti ugrađeni Djangov filter.

**Što morate znati:**
*   Kako primijeniti filter na varijablu u templateu: `{{ book.abstract|truncatewords:20 }}`.

    **Ponavljanje gradiva:** [Poglavlje 5.1: Filteri](/03-mvt-moduli/03-predlosci-statika.md#3-filteri-)

### 5. Prikazivanje Agregiranih Podataka (`.count()`)
Da biste prikazali ukupan broj knjiga ili autora, ne trebate dohvaćati sve objekte i onda u Pythonu provjeravati duljinu liste. Baza podataka to može napraviti puno brže.

**Što morate znati:**
*   Kako u `view`-u dobiti ukupan broj objekata: `broj_autora = Author.objects.count()`.
*   Kako taj broj proslijediti u template putem konteksta.

### 6. Napredno Filtriranje QuerySetova (`__startswith`)
Ovo je nadogradnja na filtriranje koje smo radili u prošloj vježbi. Django ORM nudi moćan sustav "lookupa" za filtriranje.

**Što morate znati:**
*   Kako koristiti "double underscore" (`__`) notaciju za pristup različitim vrstama filtera.
*   Za ovaj zadatak, trebat će vam `__startswith` (ili `__istartswith` za pretragu neovisnu o velikim/malim slovima).

    **Konceptualni primjer:**

        # Dohvati sve knjige čiji naslov počinje s 'A'
        knjige_s_a = Book.objects.filter(title__startswith='A')

    **Preporučeni resurs:** [Službena Django dokumentacija o Field Lookups](https://docs.djangoproject.com/en/stable/ref/models/querysets/#field-lookups)

---

## Smjernice za Rješavanje

*   **Zadatak 1 (Naredba):**
    1.  Pažljivo pratite Djangovu dokumentaciju za strukturu `management/commands`.
    2.  Napišite `handle()` metodu. Prve linije u toj metodi trebaju biti `Book.objects.all().delete()` i `Author.objects.all().delete()`.
    3.  Koristite `for` petlje za kreiranje željenog broja objekata. Unutar petlje, jednostavno pozovite `AuthorFactory()` ili `BookFactory()`.
    4.  Dodajte `self.stdout.write(self.style.SUCCESS('Poruka o uspjehu!'))` na kraj `handle()` metode za bolji ispis u konzoli.

*   **Zadatak 2 (Stranice i Navigacija):**
    1.  Kreirajte `base.html` s `{% block content %}`.
    2.  Kreirajte view za početnu stranicu. U njemu izračunajte `.count()` za oba modela i pošaljite ih u `home.html` template.
    3.  U `home.html` naslijedite `base.html` i prikažite podatke te linkove.

*   **Zadatak 3 (Liste i Filtriranje):**
    1.  Kreirajte dva standardna `ListView`-a, jedan za Autore, jedan za Knjige.
    2.  U `ListView` za autore, nadjačajte `get_context_data` kako biste u kontekst dodali i ukupan broj autora (`Author.objects.count()`), koji ćete onda prikazati u templateu.
    3.  U templateu za listu knjiga, primijenite `truncatewords` filter.
    4.  Za stranicu s filtriranjem, najlakši način je kreirati **treći, zasebni `ListView`**. U njemu, nadjačajte `get_queryset` metodu da vraća samo filtrirane rezultate (`Book.objects.filter(title__startswith='A')`).

Sretno s rješavanjem